#include "iWatch.h"

static unsigned char CODE Icon[] = {
	48, 48,
	0x00,0x00,0x00,0x00,0x00,0xE0,0x70,0x10,0x18,0x18,0x18,0x10,0x70,0xE0,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x60,0xC0,0x80,0x00,0x08,0xB8,0x80,0x80,0xC0,
	0xDF,0xCE,0xC0,0x80,0x90,0x38,0x08,0x00,0xC0,0xE0,0x70,0x20,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xFF,0x98,0x98,0x18,0x18,0x18,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0xC0,0xC0,0xC4,0xC4,0x0C,0x00,0xF0,0xFC,0x0E,0x03,0x01,0x01,0x00,0x00,
	0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x0E,0xF8,0xE0,0x04,0x8C,0xC6,0xC0,0xC0,0x80,
	0x00,0x00,0x00,0x00,0xFF,0xFF,0x73,0x73,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x18,0x18,0x08,0x80,0xC3,0x8F,0x18,0x30,0x60,0x40,0xC0,0xC0,
	0xC0,0xC0,0xC0,0xC0,0x60,0x60,0x30,0x1C,0xCF,0x81,0x08,0x08,0x18,0x00,0x00,0x00,
	0x00,0x00,0x00,0x80,0xFF,0x7F,0x0E,0x0E,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0x80,
	0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x01,0x00,0x00,0x0C,0x0E,0x00,0x00,0x00,
	0x3C,0x3C,0x00,0x00,0x02,0x0E,0x00,0x00,0x00,0x01,0x03,0x02,0x00,0x00,0x00,0x00,
	0xF0,0xFE,0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x40,0x01,
	0x03,0x1E,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x01,0x07,0x1C,0x30,0x20,0x60,0x40,0xC0,0xC0,0xC4,0xC4,0xC6,0x43,0x61,0x60,0x30,
	0x1C,0x0F,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
	/* (48 X 48 )*/
};
static t_psWidget text[6];
static t_psGroup group1;
char * code CH1[3] = 
{
	"温度：　　℃",
	"湿度：",
	"压强："
};

/**
  * @brief  页面初始化事件
  * @param  无
  * @retval 无
  */
static void Setup(unsigned char condition)
{
	unsigned char i;
	for(i = 0; i < 3; i++)
	{
		text[i] = og_label_create(FONT_GB2312_15X16, 0, i * 16);
		og_label_setText(text[i], CH1[i]);
		text[i + 3] = og_label_create(FONT_ASCII_8X16, 48, i * 16);
	}
	group1 = og_group_create(6);
	for(i = 0; i < 6; i++)
	{
		og_group_addWidget(group1, text[i], 0);
	}
	og_group_setPosOffset(group1, 0, 64);
	og_group_addAnimOffset(group1, 0, -64, ANIM_TIME_NORM, ANIM_NULL_CB);
	#if (TH_SENSOR_SELECT == 1)
	HDC2080SetMode(7);
	HDC2080StartConversion();
	#elif (TH_SENSOR_SELECT == 2)
	HDC1080Start();
	#elif (TH_SENSOR_SELECT == 3)
	HTU21DStart();
	#endif
	#if (P_SENSOR_SELECT == 1)
	BMP390SetMode(NORMAL_MODE);
	#endif
	
}
static void delet(void)
{
	og_group_delet(group1);
	pageSetStatus(page_hdc2080, PAGE_IDLE);
}
/**
  * @brief  页面退出事件
  * @param  无
  * @retval 无
  */
static void Exit(unsigned char condition)
{
	#if (TH_SENSOR_SELECT == 1)
	HDC2080SetMode(0);
	#elif (TH_SENSOR_SELECT == 2)
	#elif (TH_SENSOR_SELECT == 3)
	#endif
	#if (P_SENSOR_SELECT == 1)
	BMP390SetMode(SLEEP_MODE);
	#endif
	og_group_addAnimOffset(group1, 0, 64, ANIM_TIME_NORM, delet);
}
/**
  * @brief  页面循环执行的内容
  * @param  无
  * @retval 无
  */
static void Loop()
{
	if(pageExecuteRate(&Rate10Hz))
	{
		#if (TH_SENSOR_SELECT == 0)
		og_label_setText(text[3], "NULL");
		og_label_setText(text[4], "NULL");
		#elif (TH_SENSOR_SELECT == 1)
		HDC2080GetTH(&HDC2080);
		lablel_printf(text[3], "%2.1f", HDC2080.temperature + 0.05);
		lablel_printf(text[4], "%2.1f%%", HDC2080.humidity + 0.05);
		#elif (TH_SENSOR_SELECT == 2)
		if(HDC1080GetTH(&HDC1080))
		{
			lablel_printf(text[3], "%2.1f", HDC1080.temperature + 0.05);
			lablel_printf(text[4], "%2.1f%%", HDC1080.humidity + 0.05);
		}
		#elif (TH_SENSOR_SELECT == 3)
		static unsigned char step = 0;
		if(step == 0)
		{
			if(HTU21DGetTemperature(&HTU21D))
			{
				lablel_printf(text[3], "%2.1f", HTU21D.temperature);
				step = 1;
			}
		}
		else if(step == 1)
		{
			if(HTU21DGetHumidity(&HTU21D))
			{
				lablel_printf(text[4], "%2.1f%%", HTU21D.humidity);
				step = 0;
			}
		}
		#endif
		#if (P_SENSOR_SELECT == 0)
		og_label_setText(text[5], "NULL");
		#elif (P_SENSOR_SELECT == 1)
		BMP390GetSensorData(&BMP390);
		lablel_printf(text[5], "%.1fPa", BMP390.pressure + 0.05);
		#endif
	}
}
/**
  * @brief  页面事件
  * @param  btn:发出事件的按键
  * @param  event:事件编号
  * @retval 无
  */
static void Event(unsigned char event)
{
	if(event == KEY1_PRESSED)
		pageShift(page_menu, PAGE_RETURN);
}
void pageRegister_page_hdc2080(unsigned char pageID)
{
	pageRegister(pageID, "HDC2080", Icon, Setup, Loop, Exit, Event);
}